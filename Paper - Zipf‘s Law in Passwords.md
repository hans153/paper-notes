# Zipf‘s Law in Passwords

WANG D, CHENG H, WANG P, 等. Zipf‘s Law in Passwords[J]. IEEE Transactions on Information Forensics and Security, 2017, 12(11): 2776–2791.

TIFS，A类期刊

## 提出问题

口令认证的**security-usability dilemma**，通常的解决方案是采用口令策略控制用户创建口令的规则，问题在于：

1. 横向：口令策略不一致，相同的口令在不同站点得到强弱不同的评价；
2. 纵向：采用相同的口令策略，随着时间变化所有用户的口令分布也会变化；

管理人员为了保证账户体系的安全，需要根据口令分布来调整口令策略。但是用户创建的口令服从什么分布？

## 口令数据集

作者收集了14个公开的泄露密码数据集，简要叙述了这些数据集泄露的相关安全事件，并对其中8个数据集的字符特征、长度特征做了统计分析：

![image-20200709190351394](Paper%20-%20Zipf%E2%80%98s%20Law%20in%20Passwords.assets%5Cimage-20200709190351394.png)

![image-20200709190412446](Paper%20-%20Zipf%E2%80%98s%20Law%20in%20Passwords.assets%5Cimage-20200709190412446.png)

用户口令受到站点不同口令策略影响较大，例如Myspace用户较多使用了字母后跟数字1的Pattern，可能是由于站点的口令策略要求用户口令必须包含数字。

## 数学工具

文中对于口令数据集实际分布与理论分布模型的差距，主要使用了两种数学工具做评价

### 线性回归的决定系数

线性回归概念不做描述，作者主要使用了决定系数$R^2$（Coefficient of determination）来评价拟合程度。$R^2$可表示为：
$$
R^2=\frac{SSR}{SST}=1-\frac{SSE}{SST}
$$
其中，SSR（Sum of Squares for Regression）为回归平方和，SSE（Sum of Squares for Error）为残差平方和，SST（Sum of Squares for Total）为总离差平方和。
$$
SSR=\sum_i(f_i-\bar y)^2
$$

$$
SSE=\sum_i (y_i-f_i)^2
$$

$$
SST=\sum_i (y_i-\bar y)^2
$$

### K-S检验

除决定系数外，作者还使用了K-S检验（Kolmogorov-Smirnov Test）来评价。K-S检验主要是比较两个实际样本或一个实际样本与与一个理论分布样本的累计分布函数（Cumulative Distribution Function, CDF）之间的距离，表示为：
$$
D=\mathop{sup}\limits_{x}\left|F_n(x)-F(x)\right|
$$
其中，n是样本的大小，$F_n(x)$是样本的累计分布函数，$\mathop{sup}\limits_{x}$表示距离的上确界，如果$X_i$服从理论分布$F(x)$，则当$n$趋于无穷大时，$D$趋于0.

累计分布函数$F_n(x)$表示为：
$$
F_n(x)=\frac{1}{n}\sum_{i=1}^{n}I_\left|-\infty,x\right| (X_i)
$$
其中$I_\left|-\infty,x\right| (X_i)$为示性函数，表示为：
$$
I_\left|-\infty,x\right| (X_i)=\begin{cases}
1,X_i\le x \\
0,X_i> x
\end{cases}
$$
由于每个口令数据集分布的参数不同，作者还使用了一种基于蒙特卡洛方法的步骤来计算$p$值，即先将口令数据集在理论模型上进行参数估计，再根据拟合出的参数分布生成一些口令样本，然后再将这些生成的口令样本重新做参数估计，得到新的参数，分别计算两者的K-S距离，相除得到$p$值。

## PDF-Zipf模型

### Zipf‘s Law

指自然语言中，给定的单词语料库，每个单词的频率$f$与频率表中的排序$r$成反比。表示为：
$$
f_r=\frac{C}{r}
$$
其中$C$是常数，根据不同的语料库取值不同。

作者提出PDF-Zipf模型，即对于一个口令数据集$DS$，单条口令在频率表中的排序$r$与其频率$F_r$满足：
$$
f_r=\frac{C}{r^s}
$$
其中$C$和$s$都是常数，根据不同口令数据集的取值不同，受到所属网站的口令策略、用户群体特征等因素影响。由于是探究的是口令集的概率密度，因此称为PDF-Zipf模型。

该式也可表示为：
$$
\log f_r=\log C - s\cdot\log r
$$
即可以使用线性回归的方式分析。

作者对所选的数据集中出现频次较多（$f_r\ge3$或$f_r\ge5$）的密码进行了线性回归，结果如下表：

![image-20200709223354714](Paper%20-%20Zipf%E2%80%98s%20Law%20in%20Passwords.assets%5Cimage-20200709223354714.png)

其中，决定系数$R^2$大于等于0.95的可以认为是拟合优度较好的数据集，Hak5数据集$R^2$小于0.95，原因可能是由于泄露的口令数量过少，无法反映整体分布情况。同时，通过钓鱼攻击获得的口令数据集$R^2$要小于通过拖库方式获得的口令数据集的$R^2$，也是因为钓鱼攻击只能获得用户口令集中的一部分。

然而K-S检验的结果中，$p$值较小，可以拒绝样本是从理论分布中抽取的假设。作者认为这是由于样本数量较少导致的，如果基于足够多的样本数量估计出Zipf模型的参数，是可以获得足够大的$p$值的，这里不能得出样本不服从Zipf分布的结论。

作者在进行回归分析时，去除了口令集中出现频次较少的口令，并通过增量实验得出结论：在百万数量级的口令集中，建议保留$f_r\ge5$的口令，否则保留$f_r\ge3$的口令，此时拟合效果最好。

## PDF-Zipf模型的合理性

之所以需要去除频次较低的密码，作者基于大数定律的角度进行了论证。

对于任一口令$pw_i$，将其每一次出现视为一次伯努利实验，服从$\mu=p_{pw_i}$。经过一个口令数据集的观测，其经验概率为$\frac{f_{pw_i}}{N}$，其中N是数据集的大小。经验概率是满足$\mu=p_{pw_i}$的二项分布变量，且标准差为$\sigma=\sqrt{p_{pw_i}(1-p_{pw_i})\cdot N}$，由于任意口令在口令集总体中的概率$p_{pw_i}$非常小，满足$1-p_{pw_i}\approx 1$，则可以得到相对标准差RSE：
$$
\frac{\sigma}{\mu} = 
\sqrt{\frac{p_{pw_i}(1-p_{pw_i})}{N}}\cdot\frac{1}{p_{pw_i}} \approx
\sqrt{\frac{f_{pw_i}}{N^2}}\cdot\frac{N}{f_{pw_i}} =
\sqrt{\frac{1}{f_{pw_i}}}
$$
可知，当$f_{pw_i}$较大时，RSE较小，此时任一口令$pw_i$的真实概率$p_{pw_i}$可以较好的被样本估计。因此，在进行拟合时，将出现频次较小的口令去除，可以有效的提升拟合的良好性。

同时，从经验的角度来说，可以获取到口令集数量与所有根据口令策略生成出的口令数量相比非常少，例如限制口令长度为8-16个字符的情况下，所有可能的口令共有$62^{16}-62^{8} \approx 4.8*10^{28}$种，但采集到的应用此口令策略的口令集仅有不超过600万个口令，由于Zipf分布的多项式递减概率的特性，小概率事件将压倒高概率事件。

同时，根据数据集观察的情况，在样本越大的口令集中，流行口令，即出现频次较高的口令，所占的总体比例越高，因此去除这些不流行的口令集对样本估计的影响也随着样本数量增大而逐渐减小。

## CDF-Zipf模型

PDF-Zipf模型的一个缺憾在于无法描述出现频次较少的密码符合何种分布。由于大数定律，这些密码本身也很难被应用到一个理论模型里。但是PDF-Zipf模型证明了用户创建的口令是服从类似Zipf分布的。作者在实验中发现，每个口令数据集的累计分布函数CDF都是符合Zipf分布的，因此作者提出了CDF-Zipf模型：
$$
F_r=C'\cdot r^{s'}
$$
其中，$F_r$表示频率表中排序为$r$及以下的口令的累积分布函数，$C'$与$s'$是取决于口令集的常数，可以通过线性回归计算。由于$r=1,2,...$，因此有：
$$
f_r =
F_r-F_{r-1} =
C' \cdot r^{s'} - C' \cdot (r-1)^{s'}
$$
同时，若将$F_r$视为连续函数，$f_r$也可以通过$F_r$的导数来估计，即：
$$
f_r \approx
\frac{d(F_r)}{dr} = 
C' \cdot s' \cdot r^{s'-1}
$$
作者对14个数据集进行了拟合，结果如下：

![image-20200710005020314](Paper%20-%20Zipf%E2%80%98s%20Law%20in%20Passwords.assets%5Cimage-20200710005020314.png)

其中，所有的数据集通过K-S检验获得的距离D均比使用PDF-Zipf模型获得的距离D小，均值为0.018457。而$p$值在9个样本上也可支持样本是从理论分布模型中得出的假设。与PDF-Zipf模型类似，作者认为当样本数量足够大时，可以得到较大的$p$值，此处无法得出样本的实际分布情况不符合理论模型的结论。尽管可能会有更贴近事实分布的口令分布模型被提出，但是改进空间比较有限，因为本模型获得的K-S距离均值已经非常小。

作者还将CDF-Zipf模型、PDF-Zipf模型与[1]提出的幂率分布模型做了比较。[1]中提到的分布模型并非针对口令数据集，但也是一种Zipf模型的改进。其中，[1]中的幂率分布模型与CDF-Zipf模型在所有数据集上的拟合效果均优于PDF-Zipf模型；对与百万级别的数据集，CDF-Zipf模型表现优于[1]中的模型；在样本覆盖率上，CDF-Zipf模型最佳，为100%，[1]中的模型最差。

![image-20200710011741420](Paper%20-%20Zipf%E2%80%98s%20Law%20in%20Passwords.assets%5Cimage-20200710011741420.png)

## 应用

### 口令策略

作者采用的口令数据集中，有一些表现出了明显的口令强度策略，例如要求长度大于等于8，或至少包含1个数字等。无论是否表现出明显的口令策略，口令集的分布均满足作者提出的分布模型，因此作者做出了推断，即使设置更加严格的口令策略，用户口令数据集的分布依然符合该分布。

因此， 盲目提高口令策略的强度，可能影响更多用户的使用，同时无法有效的增强整体口令集的安全性。

### 基于口令的认证协议

大多数的基于口令的认证协议均假设用户口令服从均匀分布，在评价其安全性时使用攻击者优势表述，例如存在一个基于口令的认证密钥交换协议$\mathcal{P}$，当攻击者$\mathcal{A}$对所有大小为$|\mathcal{D}|$的口令字典和对所有多项式时间的至多进行$Q(k)$次在线猜测，攻击者优势定义为：
$$
Adv_{\mathcal{A,P}}(k) \le \frac{Q(k)}{|\mathcal{D}|}
$$
采用这个指标评价的问题在于其假设用户口令是均匀分布的，所有大小为$|\mathcal{D}|$的口令字典中的口令被攻击者采用的机会是均等的。因此，作者提出改进的方案为：
$$
Adv_{\mathcal{A,P}}(k) \le C' \cdot Q(k)^{s'}
$$
其中的参数$C',s'$应用CDF-Zipf模型分布计算得出，管理人员可以选择已经泄露公开的、用户画像与目标站点相近的的口令集计算，得出更为准确的认证协议安全性评价指标。

### 口令集强度评价指标

$\beta$-success-rate指标[2]是一种基于最优攻击的口令集强度评价指标，即当一个攻击者从最高概率的口令开始进行最优猜测攻击，至多猜测$n$次时，其平均成功率，表述为：
$$
\lambda_{n}(\mathcal{X})=\sum_{r=1}^{n}p_r(\mathcal{X}) = 
\frac{1}{N}\sum_{r=1}^{n}f_r(\mathcal{X})
$$
这里没有考虑到口令集的分布，根据作者提出的CDF-Zipf模型，可将其改进为：
$$
\lambda_{n}(\mathcal{X}) =
\sum_{r=1}^{n}p_r(\mathcal{X}) = 
F_n(\mathcal{X}) \approx
C' \cdot n^{s'}
$$
即直接采用
$$
\lambda_{n}(\mathcal{X}) =
C' \cdot n^{s'}
$$
来评价口令集的强度。

## 总结及展望

1. 该文章首次对过往口令及密码学研究中一直忽略的一个重要问题做了探究，即由用户生成的口令不是符合均匀分布的，而是满足类似自然语言的分布。这一发现可以与多个口令认证方向中过往的方法相结合，是一个非常基础性的工作。
2. 作者将一条用户口令作为整体进行分布特征分析，但在强密码策略下，用户的密码往往是由几个部分拼接而成的，例如数字+字母等。如果将口令拆分，每个部分是否具有分布特征呢？
3. 进一步地，针对字母或者数字的部分，常常会遇到字符跳变的情况，例如将“a”跳变为“@”，或将单词的某几个小写字母改为大写，这些跳变模式是否也具有分布特征？
4. 一个网站或系统的全部用户口令，其分布的模型参数随时间是否会发生变化？
5. 如果将口令策略强度大幅提升，口令是否还会满足Zipf模型？
6. 针对价值很高的账户，例如支付宝账号等，用户的口令是否还会满足Zipf模型？

## 重要参考文献

[1] CLAUSET A, SHALIZI C R, NEWMAN M E. Power-law distributions in empirical data[J]. SIAM review, SIAM, 2009, 51(4): 661–703.

[2] BOZTAS S. Entropies, Guessing and Cryptography[M]. 1999.

